{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Snapshot plugin for Craft CMS 3.x
 *
 * Snapshot Settings.twig
 *
 * @author    Enupal
 * @copyright Copyright (c) 2018 Enupal
 * @link      https://enupal.com
 * @package   Snapshot
 * @since     1.0.0
 */
#}

{% import "_includes/forms" as forms %}
{% set sourceOptions = craft.enupalsnapshot.getAvailableSources() %}

{{ forms.field({
    label: "Please download and install <a href='https://wkhtmltopdf.org/'>wkhtmltopdf</a> 0.12.x in order to use Enupal Snapshot. More info <a href='https://enupal.com/craft-plugins/enupal-snapshot/docs/getting-started/installation-setup'>here</a>."|t('enupal-snapshot'),
}, null) }}
{{ forms.textField({
    label: 'Absolute Binary Path of wkhtmltopdf lib',
    instructions: '/usr/local/bin/wkhtmltopdf',
    id: 'pdfBinPath',
    name: 'pdfBinPath',
    required: true,
    errors: settings.getErrors('pdfBinPath'),
    value: settings['pdfBinPath']}) }}

{{ forms.textField({
    label: 'Absolute Binary Path of wkhtmltoimage lib',
    instructions: '/usr/local/bin/wkhtmltoimage',
    id: 'imageBinPath',
    name: 'imageBinPath',
    errors: settings.getErrors('imageBinPath'),
    required: true,
    value: settings['imageBinPath']}) }}

{{ forms.textField({
    label: 'Timeout',
    instructions: 'Timeout in seconds. Default is 60',
    id: 'timeout',
    name: 'timeout',
    errors: settings.getErrors('timeout'),
    value: settings['timeout']}) }}

{% macro uploadLocationInput(name, settings, inputSourceOptions) %}
    {% from "_includes/forms" import select, text %}
    <div class="flex">
        <div>
            {{ select({
                id: name~'Source',
                name: name~'Source',
                options: inputSourceOptions,
                value: settings[name~'Source'],
            }) }}
        </div>
        <div class="flex-grow">
            {{ text({
                id: name~'Subpath',
                class: 'ltr',
                name: name~'Subpath',
                value: settings[name~'Subpath'],
                placeholder: "path/to/subfolder"|t('enupal-snapshot')
            }) }}
        </div>
    </div>
{% endmacro %}

{% from _self import uploadLocationInput %}

{% set uploadLocationNote = "Note that the subfolder path can contain variables like <code>{slug}</code> or <code>{author.username}</code>."|t('enupal-snapshot') %}

{{ forms.field({
    label: "PDF's downloaded location"|t('enupal-snapshot'),
    instructions: uploadLocationNote,
    errors: settings.getErrors('singleUploadLocationSubpath')
}, uploadLocationInput('singleUploadLocation', settings, sourceOptions)) }}